---
title: React v18 변경 사항
date: 2022-07-29
comments: true
categories: [Web, React]
tags: [React, v18]
lastmode: 2022-07-29 17:00:00
sitemap:
  changefreq: daily
  priority: 1.0
---

## 자동 batching(일괄) 처리

### batching 처리란?

동일한 클릭 이벤트 내에 두 개의 상태 업데이트가 있는 경우 React는 항상 이를 하나의 재렌더링으로 일괄 처리한다.
다음 코드를 실행하면 클릭할 때마다 상태를 두 번 설정하더라도 React는 단일 렌더링만 수행하는 것을 볼 수 있다.
불필요한 재렌더링을 줄여 성능을 확보하는 렌더링 방식이였다.

```jsx
function App() {
  const [count, setCount] = useState(0);
  const [flag, setFlag] = useState(false);

  function handleClick() {
    setCount((c) => c + 1); // 리렌더링이 일어나지않음
    setFlag((f) => !f); // 리렌더링이 일어나지않음
    // React에선 한번의 렌더링으로 일괄처리
  }

  return (
    <div>
      <button onClick={handleClick}>Next</button>
      <h1 style={{ color: flag ? "blue" : "black" }}>{count}</h1>
    </div>
  );
}
```

하지만 React에서 일괄 처리는 일관성이 없었다. 예를들어 다른곳에서 데이터를 불러와 State를 업데이트하는 경우엔 각자 독립적인 렌더링이 일어났다.

```jsx
function App() {
  const [count, setCount] = useState(0);
  const [flag, setFlag] = useState(false);

  function handleClick() {
    fetchSomething().then(() => {
      // 콜백 이밴트는 이벤트가 종료됐다고 판단하여 일괄처리가 되지 않음
      setCount((c) => c + 1); // 리렌더링
      setFlag((f) => !f); // 리렌더링
    });
  }

  return (
    <div>
      <button onClick={handleClick}>Next</button>
      <h1 style={{ color: flag ? "blue" : "black" }}>{count}</h1>
    </div>
  );
}
```

위와 같이 react 이벤트 핸들러가 아닌 Promise, setTimeout, 기본 이벤트 핸들러 등에서는 React에서 일괄처리를 할 수 없었다.

### Automatic Batching (자동 일괄 처리)

React v18에서는 createRoot 내에 모든 업데이트는 출처와 상관없이 자동으로 일괄 처리하게끔 변경 되었다.

아까와 같은 코드로 예를 들자면

```jsx
function App() {
  const [count, setCount] = useState(0);
  const [flag, setFlag] = useState(false);

  function handleClick() {
    fetchSomething().then(() => {
      // React 18 버전 이후
      setCount((c) => c + 1);
      setFlag((f) => !f);
      // 한 번의 리렌더링
    });
  }

  return (
    <div>
      <button onClick={handleClick}>Next</button>
      <h1 style={{ color: flag ? "blue" : "black" }}>{count}</h1>
    </div>
  );
}
```
